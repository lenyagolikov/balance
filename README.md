# Микросервис для работы с балансом пользователей
Тестовое задание на позицию стажера-бэкендера в Avito, условие задания находится в `spec.md`
## Что внутри?
Приложение упаковано в Docker-контейнер и разворачивается с помощью docker-compose.

Внутри Docker-контейнера доступны две команды:
1. `app-db` - утилита для создания таблиц в БД
2. `app` - утилита для запуска приложения

## Как запустить локально с Docker?
1. Изменить в Makefile `include deploy/.env.test` на `include deploy/.env.prod`
2. Выполнить команду `make run` в терминале в корневой директории проекта.
3. Для остановки контейнеров используйте `make stop`

## Как запустить локально без Docker?
Создание и активация виртуального окружения
```
python3.10 -m venv venv
source venv/bin/activate
```
Активация переменных окружения (заранее нужно изменить данные в deploy/.env.test под себя)
```
export $(grep -v '^#' deploy/.env.test | xargs)
```
Установка приложения через `pip`, создание таблиц в БД и запуск приложения
```
pip install -e .
app-db
app
```
Проверка работоспособности
```
curl localhost:8080/ping/app
curl localhost:8080/ping/db
```

## Разработка
### Быстрые команды
- `make run` Запуск контейнеров
- `make build` Ресборка контейнеров при изменениях в коде
- `make stop` Остановка контейнеров
- `make lint` Запуск линтера flake8
- `make cs` Запуск black для форматироваия кода 
- `make test` Запуск тестов
- `make test-cov` Запуск тестов с покрытием кода
- `make test-cov-html` Запуск тестов с отчетом в html
- `make req` Обновление зависимостей
